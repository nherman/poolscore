{% extends "master.html" %}
{% set body_class = "root-context" %}

{% block script %}
<script type="text/javascript">
function addMatchViewModel(options) {
    var self = this,
        options = ko.utils.extend({
            "tourney_id": undefined,
            "home_players": [],
            "away_players": [],
            "onAdd": function() {}
        }, options);

    function _isEmpty(v) { return (v == undefined || v == null || v == "" || v == -1);}

    function _getPlayerId(o) {
        a = o.split('_');
        return {
            "team": a[0],
            "id": a[1]
        }
    }

    function _getPlayerSelectItem(p, team) {
        return {
            "value":team + "_" + p.id,
            "label":p.last_name + ", " + p.first_name + " (" + p.handicap + ")",
            "team": team
        };
    }

    self.selectItems = {
        "home": [],
        "away": []
    };

    self.lag_winner = ko.observable();
    self.lag_loser = ko.observable();

    self.resetForm = function() {
        self.lag_winner(-1);
        self.lag_loser(-1);
    };

    self.canAdd = ko.computed(function() {
        var wid, lid;
        if (_isEmpty(self.lag_winner()) || _isEmpty(self.lag_loser())) {
            return false;
        }
        wid = _getPlayerId(this.lag_winner());
        lid = _getPlayerId(this.lag_loser());
        if(wid.id == lid.id || wid.team == lid.team) return false;
        return true;
    }, self)

    self.init = function(initOptions) {
        initOptions = initOptions || {};
        options = ko.utils.extend(options, initOptions);

        ko.utils.arrayForEach(options.home_players, function(p) {
            self.selectItems.home.push(_getPlayerSelectItem(p, 'home'));
        });
        ko.utils.arrayForEach(options.away_players, function(p) {
            self.selectItems.away.push(_getPlayerSelectItem(p, 'away'));
        });
    }

    self.add = function() {
        var data = {
                "match":{
                    "events": {
                        "lag": null
                    }
                },
                "home_players": [],
                "away_players": []
            };

        function _populateData(p,w) {
            var o = _getPlayerId(p);
            data[o.team + '_players'].push(o.id);
            if (w) {
                data.match.events.lag = o.team;
            }
        }

        if (!self.canAdd()) return;

        _populateData(this.lag_winner(),true);
        _populateData(this.lag_loser(),false);


        PS.API.createMatch(options.tourney_id, data,
            function(json) {
                self.resetForm();
                options.onAdd(json);
                //TODO create game
            }
        );
    };

}

function ViewModel() {
    var self = this,
        tourney_id = "{{ tourney_id }}",
        matches_endpoint,
        initTemplateOptions = {
            "name": ""
        },
        headerTemplateOptions = {
            "name": "header_template",
            "data": {}
        },
        matchTemplateOptions = {
            "name": "match_template",
            "data": {}
        };


    /* initialize templates */
    self.headerTemplateOptions = ko.observable(initTemplateOptions);
    self.matchTemplateOptions = ko.observable(initTemplateOptions);

    /* Render Add Match Form */
    self.addMatchViewModel = new addMatchViewModel({
        "tourney_id": tourney_id,
        "onAdd": function(resp) {
            var match, matchJSON = resp.match || resp;
            if (typeof matchJSON == "object" && matchJSON.id !== undefined) {
                match = new Match(matchJSON.id, {
                    "json": matchJSON,
                    "tourney": self.tourney
                });
                match.addGame();
                self.matches.push(match);
            }
        }
    });


    /* populate Tourney model */
    self.tourney = new Tourney(tourney_id, {

        /* Tourney onInit callback */
        "callback": function() {

            /* update add match form to include available players */
            self.addMatchViewModel.init({
                "home_players": self.tourney.home_team.players,
                "away_players": self.tourney.away_team.players
            });

            /* render templates */
            headerTemplateOptions.data = self.tourney;
            self.headerTemplateOptions(headerTemplateOptions);

            matchTemplateOptions.data = self;
            self.matchTemplateOptions(matchTemplateOptions);
        }
    });

    /* get all Matches */
    self.matches = ko.observableArray();

    PS.API.getMatches(tourney_id,
        function(json) {
            if (json === undefined || typeof json != "object") return;

            ko.utils.arrayForEach(json["matches"], function(match){
                self.matches.push(new Match(match.id, {
                    "json": match,
                    "tourney": self.tourney
                }));
            });
        }
    );

    /* display game edit view */
    self.editGame = function(game) {
        self.matchTemplateOptions({
            "name": "edit_game_template",
            "data": game
        });
    };

    self.displayMatch = function() {
        self.matchTemplateOptions(matchTemplateOptions);
    };

}

window.PS.API = (function() {
    var root = "/api/v1.0/";

    function _p(path) {
        var i=1;
        if (path === undefined) return "";

        while(i < arguments.length) {
            path = path.replace(/%s/,arguments[i++]);
        }

        return root + path;
    }

    function _run(method, url, payload, callback) {
        var settings = {
                type: method,
                url: url,
                data: payload,
                dataType: "json"
            };

        if (method == undefined || url == undefined) return;

        if (typeof payload == 'object') {
            if ($.isEmptyObject(payload)) {
                settings.data = '';
            } else {
                settings.data = JSON.stringify(payload);
            }
        } else {
            settings.data = payload;
        }

        if (typeof callback == "function") {
            settings.success = callback;
        }

        return $.ajax(settings);
    }

    function _get(url, callback) {
        return _run("GET", url, "", callback)
    }

    function _put(url, payload, callback) {
        return _run("PUT", url, payload, callback)
    }

    function _post(url, payload, callback) {
        return _run("POST", url, payload, callback)
    }

    function _delete(url, callback) {
        return _run("DELETE", url, "", callback)
    }

    return {
        getTourney: function(tourney_id, callback) {
            var url = _p("tourneys/%s.json", tourney_id);
            return _get(url, callback);
        },

        updateTourney: function(tourney_id, data, callback) {
            var url = _p("tourneys/%s.json", tourney_id);
            return _put(url, data, callback);
        },

        getMatches: function(tourney_id, callback) {
            var url = _p("tourneys/%s/matches.json", tourney_id);
            return _get(url, callback);
        },

        createMatch: function(tourney_id, data, callback) {
            var url = _p("tourneys/%s/matches.json", tourney_id);
            return _post(url, data, callback);
        },

        getMatch: function(tourney_id, match_id, callback) {
            var url = _p("tourneys/%s/matches/%s.json", tourney_id, match_id);
            return _get(url, callback);
        },

        updateMatch: function(tourney_id, match_id, data, callback) {
            var url = _p("tourneys/%s/matches/%s.json", tourney_id, match_id);
            return _put(url, data, callback);
        },

        getGames: function(tourney_id, match_id, callback) {
            var url = _p("tourneys/%s/match/%s/games.json", tourney_id, match_id);
            return _get(url, callback);
        },

        createGame: function(tourney_id, match_id, data, callback) {
            var url = _p("tourneys/%s/matches/%s/games.json", tourney_id, match_id);
            return _post(url, data, callback);
        },

        getGame: function(tourney_id, match_id, game_id, callback) {
            var url = _p("tourneys/%s/matches/%s/games/%s.json", tourney_id, match_id, game_id);
            return _get(url, callback);
        },

        updateGame: function(tourney_id, match_id, game_id, data, callback) {
            var url = _p("tourneys/%s/matches/%s/games/%s.json", tourney_id, match_id, game_id);
            return _put(url, data, callback);
        }
    }

})();

window.PS.utils = (function() {
    return {
        isEmpty: function(v) {
            return (v == undefined || v == null || v == "");
        }
    };
})();

/* Parent class for Tourney, Match & Game */
function Entity(id, config) {
    var self = this,
        config = ko.utils.extend({
            "callback": function() {},
            "map_config": {}
        }, config),
        _map_config = {
            'ignore': ['configuration','id','ordinal'],
            'observe': ['data','events'],
            'events': {
                'create': eventFieldMapHandler,
                'update': eventFieldMapHandler
            }
        };

    function eventFieldMapHandler(options) {
        var events = options.data
        if(typeof events === "string") {
            events = ko.utils.parseJson(events);
        }
        return ko.observable(ko.mapping.fromJS(events));
    }

    /* merge config.map_config with _map_config and copy merged object to config.map_config */
    for (key in config.map_config) {
        if (config.map_config.hasOwnProperty(key)) {
            if (config.map_config[key] instanceof Array) {
                _map_config[key] = _map_config[key].concat(config.map_config[key]);
            } else {
                _map_config[key] = config.map_config[key];                
            }
        }
    }

    self.id = id;
    self.configuration = config;
    self.configuration.map_config = _map_config;

    self.onBeforeMap();

    /* initialize model data */
    if (typeof self.configuration.json == "object") {
        self.map(self.configuration.json);
        self.onAfterMap(self.configuration.json);
        self.configuration.callback();
    } else {
        self.get(function(json) {
            self.configuration.callback();
        });
    }
}

Entity.prototype.onBeforeMap = function() {};
Entity.prototype.onAfterMap = function() {};

Entity.prototype.map = function(json) {
    ko.mapping.fromJS(json, this.configuration.map_config, this);
};

Entity.prototype.get = function() {
    throw "get method not defined";
};

Entity.prototype.update = function() {
    throw "update method not defined";
};
function _incEvent(name, num) {
    try {
        this.events()[name](this.events()[name]()*1+num);
        if (this.events()[name]() < 0) {
            /* sanity check: no negative events */
            this.events()[name](0);
            return;
        }
    } catch(e) {
        return;
    }

    this.update();
}
Entity.prototype.eventIncrement = function(name) {
    _incEvent.call(this, name, 1);
}
Entity.prototype.eventDecrement = function(name) {
    _incEvent.call(this, name, -1);
}


function Tourney(id, options) {
    var self = this,
        options = ko.utils.extend({
            "map_config": {
                'ignore': ['tourneyDate'],
                'observe': ['date','winner_id','home_score','away_score'],
                'date': {
                    create: function(options) {
                        self.tourneyDate = ko.computed(function() {
                            /* hack to disregard time zone. Needs to be fixed - probably in the data model */
                            var date = new Date(self.date());
                            var date2 = new Date(date.getTime() + date.getTimezoneOffset()*60*1000);
                            return date2.toDateString();
                        });                    
                        return ko.observable(options.data);
                    }
                }
            }
        }, options);

    Entity.call(self, id, options);
}
Tourney.prototype = Object.create(Entity.prototype);

Tourney.prototype.onAfterMap = function(json) {
    self.home_team_id = json.home_team_id;
    self.away_team_id = json.away_team_id;
};

Tourney.prototype.get = function(callback) {
    var self = this;
    PS.API.getTourney(self.id, function(json) {
        self.map(json["tourney"]);
        self.configuration.json = json; //save raw data
        self.onAfterMap(json["tourney"]);
        if (typeof callback == "function") {
            callback.call(self, json);
        }
    });
};

Tourney.prototype.update = function(callback) {
    var self = this,
        data = {};

    /* wrap data in entity name node and remove extraneous objects */
    data["tourney"] = ko.mapping.toJS(self);
    delete data["tourney"].home_team;
    delete data["tourney"].away_team;

    PS.API.updateTourney(self.id, data, function(json) {
        if (typeof callback == "function") {
            callback.call(self, json);
        }
    });
};

function Match(id, options) {
    var self = this,
        options = ko.utils.extend({
            "map_config": {
                'ignore': ['tourney', 'lag_winner', 'lag_loser', 'in_progress', 'games'],
                'observe': ['home_score','home_games_won','away_score','away_games_won','winner_id']
            }
        }, options);

    self.tourney = options.tourney;
    self.in_progress = ko.observable();
    self.lag_winner = ko.observable();
    self.lag_loser = ko.observable()
    self.games = ko.observableArray();

    self.hasGameInProgress = ko.computed(function() {
        var i=0;
        for (;i<self.games().length;i++) {
            if (self.games()[i].in_progress()) {
                return true;
            }
        }
        return false;
    });

    self.canAdd = ko.computed(function() {
        var json = options.json;
        return json.home_games_won < json.home_games_needed &&
            json.away_games_won < json.away_games_needed;

    });

    Entity.call(self, id, options);
}
Match.prototype = Object.create(Entity.prototype);

Match.prototype.onAfterMap = function(json) {
    var self = this;

    /* populate games array */
    self.games().length = 0;
    ko.utils.arrayForEach(json["games"], function(game){
        self.games.push(new Game(game.id, {
            "tourney": self.tourney,
            "match": self,
            "json": game
        }));
    });

    /* get teams

    /* initialize lag winner/loser */
    lag_team = self.events().lag();
    no_lag_team = (lag_team == "home") ? "away" : "home";
    self.lag_winner(self[lag_team + "_players"][0]);
    self.lag_loser(self[no_lag_team + "_players"][0]);

    self.in_progress(window.PS.utils.isEmpty(self.winner_id()));
    self.ordinal = self.configuration.json.ordinal;
};

Match.prototype.get = function(callback) {
    var self = this;

    PS.API.getMatch(self.tourney.id, self.id,
        function(json) {
            self.map(json["match"]);
            self.configuration.json = json; //save raw data
            self.onAfterMap(json["match"]);
            if (typeof callback == "function") {
                callback.call(self, json);
            }
        }
    );
};

Match.prototype.update = function(callback) {
    var self = this,
        data = {};

    data["match"] = ko.mapping.toJS(self);

    PS.API.updateMatch(self.tourney.id, self.id, data,
        function(json) {
            if (typeof callback == "function") {
                callback.call(self, json);
            }
        }
    );
};

Match.prototype.addGame = function(callback) {
    var self = this,
        breaker_id,
        data = {"game":{}};

    if (self.games().length === 0) {

        /* First game. Breaker == lag winner */
        if (self.lag_winner() !== undefined) {
            breaker_id = self.lag_winner().id;
        }

    } else {

        /* Sanity check: one game at a time */
        if (self.games()[self.games().length-1].in_progress()) {
            return;
        }

        /* Sanity check: match complete? */
        if (
            self.match.configuration.json.home_games_won >= self.match.configuration.json.home_games_needed ||
            self.match.configuration.json.away_games_won >= self.match.configuration.json.away_games_needed
            ) {
            return;
        }

        /* breaker is the last game's winner */
        breaker_id = self.games()[self.games().length-1].winner_id();

    }

    if (breaker_id !== undefined) {
        data["game"]["events"] = {
            "breaker":breaker_id
        };
    }

    PS.API.createGame(self.tourney.id, self.id, data,
        function(json) {
            if (json !== undefined && typeof json === "object" && json.hasOwnProperty('game')) {
                self.games.push(new Game(json.game.id, {
                    "tourney": self.tourney,
                    "match": self,
                    "json": json.game
                }));
            }

            if (typeof callback == "function") {
                callback.apply(self, arguments);
            }
        }
    );
}

function Game(id, options) {
    var self = this,
        options = ko.utils.extend({
            "map_config": {
                'ignore': ['tourney', 'match','in_progress'],
                'observe': ['winner_id']
            }
        }, options);

    self.tourney = options.tourney;
    self.match = options.match;
    self.in_progress = ko.observable();

    Entity.call(self, id, options);
}
Game.prototype = Object.create(Entity.prototype);


Game.prototype.onAfterMap = function(json) {
    var self = this;
    self.in_progress(window.PS.utils.isEmpty(self.winner_id()));
    self.ordinal = self.configuration.json.ordinal;
};

Game.prototype.get = function(callback) {
    var self = this;

    PS.API.getGame(self.tourney.id, self.match.id, self.id,
        function(json) {
            self.map(json["game"]);
            self.configuration.json = json; //save raw data
            self.onAfterMap(json["game"]);
            if (typeof callback == "function") {
                callback.call(self, json);
            }
        }
    );
};

Game.prototype.update = function(callback) {
    var self = this,
        data = {};

    data["game"] = ko.mapping.toJS(self);

    PS.API.updateGame(self.tourney.id, self.match.id, self.id, data,
        function(json) {
            if (typeof callback == "function") {
                callback.call(self, json);
            }
        }
    );
};

Game.prototype.setWinner = function(team) {
    var self = this;
    // set winner id
    self.winner_id(self.match.tourney[team + "_team_id"]);

    // set in progress
    self.in_progress(false);

    //update game
    self.update(function(json) {
        self.match.get();
    });

    //TODO: update match status if match is complete

};


//ko.applyBindings(new Tourney("{{ tourney_id }}"), document.getElementById('tourney'));
ko.applyBindings(new ViewModel(), document.getElementById('main'));
</script>
{% endblock %}

{% block body %}
    <!-- ko template: headerTemplateOptions --><!-- /ko -->
    <!-- ko template: matchTemplateOptions --><!-- /ko -->


<script type="text/html" id="header_template">
    <div id="tourney">
        <h6 class="text-center"><span data-bind="text: tourneyDate()"></span> <span data-bind="text: events().start_time()"></span></h6>
        <h3 class="text-center"><span data-bind="text: home_team.name"></span> <small>(Home)</small><br/><small>vs.</small><br/><span data-bind="text: away_team.name"></span> <small>(Away)</small></h3>
    </div>
</script>

<script type="text/html" id="match_template">
    <table class="match_list">
        <thead>
            <tr>
                <th>Player Name</th>
                <th class="rotate">Games<br>Needed</th>
                <th class="rotate">Games<br>Won</th>
                <th class="rotate">Match<br>Points</th>
            </tr>
        </thead>
        <tbody>

        <!-- ko foreach: {data: matches, as: 'match'} -->
            <tr data-bind=" css: {'active_pulse': match.in_progress()},
                            template: {
                                name: 'display_player_template', data: {
                                    match: match,
                                    player: match.lag_winner(),
                                    team: match.events().lag()
                                },
                                if: match.lag_winner()
                            } ">
            </tr>
            <tr data-bind=" css: {'active_pulse': match.in_progress()},
                            template: {
                                name: 'display_player_template',
                                data: {
                                    match: match,
                                    player: match.lag_loser(),
                                    team: (match.events().lag() == 'home') ? 'away' : 'home'
                                },
                                if: match.lag_loser()
                            } ">
            </tr>

            <!-- ko if: match.in_progress() == true -->
            <!-- ko foreach: {data: games, as: 'game'} -->
                <tr data-bind="click: $root.editGame, css: {'active_pulse': game.in_progress()}">
                    <td colspan="4" data-bind="template: {
                                    name: 'display_game_template',
                                    data: {
                                        game: game
                                    }
                                }">
                    </td>
                </tr>
            <!-- /ko -->

            <tr>
                <td colspan="4"><button class="btn btn-default" data-bind="visible: canAdd() && !hasGameInProgress(), click: addGame">New Game</button></td>
            </tr>

            <tr>
                <td colspan="4"></td>
            </tr>
            <!-- /ko -->
        <!-- /ko -->

        <!-- ko with: addMatchViewModel -->
            <tr>
                <td colspan="4"><h5>Next Match:</h5></td>
            </tr>
            <tr class="top-row">
                <td data-bind="template: { name: 'select_player_template', data: {
                    options:selectItems,
                    value:lag_winner,
                    placeholder: 'Select Lag Winner'
                }}"></td>
                <td colspan="4" rowspan="2" class="text-center" style="vertical-align: middle;" data-bind="if: canAdd"><button class="btn btn-default" data-bind="click: add, text: 'Start Match'">Start Match</button></td>
            </tr>
            <tr class="bottom-row">
                <td data-bind="value: lag_loser , template: { name: 'select_player_template', data: {
                    options:selectItems,
                    value:lag_loser,
                    placeholder: 'Select Lag Loser'
                }}"></td>
            </tr>
        <!-- /ko -->

        </tbody>
    </table>
</script>

<script type="text/html" id="game_template">
</script>

<script type="text/html" id="display_player_template">
    <td>
        <span style="font-weight:bold;" data-bind="text: (team == 'home') ? 'H' : 'A'"></span>&nbsp;
        <span data-bind="text: player.first_name"></span>
        <span data-bind="text: player.last_name"></span>
        (<span data-bind="text: player.handicap"></span>)
        <a data-bind="attr: {href: '/team/player/' + player.id}, text: player.player_id" href="#"></a>
    </td>
    <td data-bind="text: match[team+'_games_needed']"></td>
    <td data-bind="text: match[team+'_games_won']"></td>
    <td data-bind="text: match[team+'_score']"></td>
</script>

<script type="text/html" id="display_game_template">
    <table>
        <tr>
            <td style="background-color: #fafafa;" rowspan="2">
                <span style="font-weight:bold;">#<span data-bind="text: game.ordinal"></span></span>
            </td>
            <td rowspan="2">
                <span>Innings: <span data-bind="text: game.events().innings()"></span></span><br>
                <span>winner: <span data-bind="text: game.winner_id()"></span></span>
            </td>
            <td>
                <span style="font-weight:bold;">H</span>&nbsp;
                <span>coaches: <span data-bind="text: game.events().home_coaches()"></span></span>
                <span>safes: <span data-bind="text: game.events().home_safes()"></span></span>
            </td>
        </tr>
        <tr>
            <td>
                <span style="font-weight:bold;">A</span>&nbsp;
                <span>coaches: <span data-bind="text: game.events().away_coaches()"></span></span>
                <span>safes: <span data-bind="text: game.events().away_safes()"></span></span>
            </td>
        </tr>
    </table>
</script>

{# edit_game_template requries game context #}
<script type="text/html" id="edit_game_template">
    <a href="#" data-bind="click: $root.displayMatch">close</a><br>
    <span>Match: #<span data-bind="text: match.ordinal"></span></span>&nbsp;
    <span>Game: #<span data-bind="text: ordinal"></span></span>&nbsp;
    <span>in progress: <span data-bind="text: in_progress"></span></span><br>
    <span data-bind="with: match">
        <span data-bind="style: {'font-weight': tourney.home_team_id == $parent.winner_id() ? 'bold' : 'normal'}">
            <span data-bind="text: home_players[0].first_name"></span>
            <span data-bind="text: home_players[0].last_name"></span>
            <span data-bind="visible: tourney.home_team_id == $parent.winner_id, text: '(winner)'"></span>
        </span>
    </span>
    &nbsp;vs.&nbsp;
    <span data-bind="with: match">
        <span data-bind="style: {'font-weight': tourney.away_team_id == $parent.winner_id() ? 'bold' : 'normal'}">
            <span data-bind="text: away_players[0].first_name"></span>
            <span data-bind="text: away_players[0].last_name"></span>
            <span data-bind="visible: tourney.away_team_id == $parent.winner_id, text: '(winner)'"></span>
        </span>
    </span>

    <br><br>
    <p>
    Innings: <span data-bind="text: events().innings"></span> 
            <a class="btn btn-default" href="#" data-bind="click: function() {
                eventIncrement('innings');
            }">+</a>
            <a class="btn btn-default" href="#" data-bind="click: function() {
                eventDecrement('innings');
            }">-</a>
    </p>

    <div class="row">
        <div class="col-xs-5 col-xs-offset-1">
            Home Safes: <span data-bind="text: events().home_safes"></span> 
                    <a class="btn btn-default" href="#" data-bind="click: function() {
                        eventIncrement('home_safes');
                    }">+</a>
                    <a class="btn btn-default" href="#" data-bind="click: function() {
                        eventDecrement('home_safes');
                    }">-</a>
        </div>
        <div class="col-xs-5 col-xs-offset-1">
            Away Safes: <span data-bind="text: events().away_safes"></span> 
                    <a class="btn btn-default" href="#" data-bind="click: function() {
                        eventIncrement('away_safes');
                    }">+</a>
                    <a class="btn btn-default" href="#" data-bind="click: function() {
                        eventDecrement('away_safes');
                    }">-</a>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-5 col-xs-offset-1">
            Home Coaches: <span data-bind="text: events().home_coaches"></span> 
                    <a class="btn btn-default" href="#" data-bind="click: function() {
                        eventIncrement('home_coaches');
                    }">+</a>
                    <a class="btn btn-default" href="#" data-bind="click: function() {
                        eventDecrement('home_coaches');
                    }">-</a>
        </div>
        <div class="col-xs-5 col-xs-offset-1">
            Away Coaches: <span data-bind="text: events().away_coaches"></span> 
                    <a class="btn btn-default" href="#" data-bind="click: function() {
                        eventIncrement('away_coaches');
                    }">+</a>
                    <a class="btn btn-default" href="#" data-bind="click: function() {
                        eventDecrement('away_coaches');
                    }">-</a>
        </div>
    </div>

    <p>
        <form>
            <select name="special_event_option" class="form-control"
                    data-bind="options:events().special_event_options, value: events().special_event, event { change: update }">
            </select>
        </form>
    </p>

    <p data-bind="text: winner_id"></p>

    <div class="row">
        <div class="col-xs-5 col-xs-offset-1">
            <button class="btn" data-bind="click: function() {
                    setWinner('home');
                    $root.displayMatch();
                }, css: {
                    'btn-success':match.tourney.home_team_id == winner_id(),
                    'btn-default':match.tourney.home_team_id != winner_id()
                }">Home Wins</button>
        </div>
        <div class="col-xs-5 col-xs-offset-1">
            <button class="btn" data-bind="click: function() {
                    setWinner('away');
                    $root.displayMatch();
                }, css: {
                    'btn-success':match.tourney.away_team_id == winner_id(),
                    'btn-default':match.tourney.away_team_id != winner_id()
            }">Away Wins</button>
        </div>
    </div>

</script>

<script type="text/html" id="select_player_template">
    <select required placeholder="Select a Player" data-bind="value: value">
        <option default selected="selected" data-bind="text: placeholder, value: -1">Select a Player</option>
        <optgroup label="Home Team" data-bind="foreach: options.home">
            <option data-bind="text: label, value: value" ></option>
        </optgroup>
        <optgroup label="Away Team" data-bind="foreach: options.away">
            <option data-bind="text: label, value: value" ></option>
        </optgroup>
        <option value="0">FORFEIT</option>
    </select>
</script>


{% endblock %}
